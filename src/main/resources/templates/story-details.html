<!DOCTYPE html>

<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="icon" href="/images/gnolp.png" type="image/x-icon" />
    <script src="/js/js.js" defer></script>

    <!-- Bootstrap CSS v5.2.1 -->

    <link href="/bootstrap.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="/app.css" />

    <title>Demo Truyện</title>
    <meta
      name="description"
      content="Đọc truyện online, truyện hay. Demo Truyện luôn tổng hợp và cập nhật các chương truyện một cách nhanh nhất."
    />
  </head>
  <style>
    #story-review {
      white-space: pre-wrap !important;
      word-break: break-word !important;
    }

    .list-group-itemC img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
      margin-right: 10px;
    }

    .chapter-list-container {
      display: flex;
      flex-wrap: wrap;
    }

    .column {
      width: 50%;
      box-sizing: border-box;
      padding: 10px;
    }

    .pagination-controls {
      display: flex;
      justify-content: center; /* Căn giữa các nút */
      align-items: center;
      margin-top: 20px;
      gap: 10px; /* Khoảng cách giữa các nút */
    }
	#pagination {
	    display: flex;
	    flex-wrap: wrap;
	    gap: 10px;
	    justify-content: center;
	    max-width: 600px; /* Giới hạn chiều rộng để tự động xuống dòng sau 6 nút */
	  }

	  #pagination button {
	    flex: 1 0 15%; /* Mỗi nút chiếm khoảng 15% chiều rộng => ~6 nút mỗi dòng */
	    min-width: 90px;
	    max-width: 120px;
	    white-space: nowrap;
	    overflow: hidden;
	    text-overflow: ellipsis;
	  }

	  .btn.active {
	    background-color: #0d6efd;
	    color: white;
	  }
	.rating-container {
	    font-family: Arial, sans-serif;
	    text-align: center;
	}

	.stars {
	    display: flex;
	    justify-content: center;
	    gap: 5px;
	}
	.star-border {
	    width: 36px; 
	    height: 36px;
	    background-color: #766728; /* Màu viền */
	    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
	    position: absolute;
	    top: 0;
	    left: 0;
	}
	.star {
	    width: 30px;
	    height: 30px;
	    background-color: #ddd; /* Màu nền mặc định của sao */
	    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
	    position: relative;
	    display: inline-block;
	}

	/* Sao đầy */
	.star.filled {
	    background-color: gold;
	}

	/* Sao một phần */
	.star.partial {
	    background-color: #ddd; /* Màu xám cho sao chưa đầy */
	    position: relative;
	    overflow: hidden;
	}

	.star.partial::before {
	    content: "";
	    position: absolute;
	    top: 0;
	    left: 0;
	    width: var(--partial-width, 50%); /* Phần được tô */
	    height: 100%;
	    background-color: gold; /* Màu vàng cho phần bị lấp đầy */
	}

	.comment {
	      display: flex;
	      align-items: flex-start;
	      justify-content: space-between;
	      padding: 12px;
	      border: 1px solid #ddd;
	      border-radius: 8px;
	      margin-bottom: 12px;
	      position: relative;
	      background-color: #fff;
	    }

	    .comment-left {
	      display: flex;
	      gap: 10px;
	    }

	    .avatar {
	      width: 40px;
	      height: 40px;
	      border-radius: 50%;
	      background-color: #ccc;
	      flex-shrink: 0;
	    }

	    .comment-content {
	      display: flex;
	      flex-direction: column;
	    }

	    .comment-header {
	      font-weight: bold;
	    }

	    .comment-time {
	      font-size: 12px;
	      color: gray;
	    }

	    .comment-text {
	      margin-top: 4px;
	    }

	    .comment-options {
	      cursor: pointer;
	      font-size: 20px;
	      padding: 4px;
	      border-radius: 50%;
	      transition: background-color 0.2s ease;
	      position: relative;
	    }

	    .comment-options:hover {
	      background-color: #eee;
	    }

	    .dropdown-menu {
	      position: absolute;
	      right: 0;
	      top: 40px;
	      background-color: white;
	      border: 1px solid #ccc;
	      border-radius: 6px;
	      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
	      display: none;
	      z-index: 10;
	    }

	    .dropdown-menu button {
	      background: none;
	      border: none;
	      padding: 8px 16px;
	      width: 100%;
	      text-align: left;
	      cursor: pointer;
	    }

	    .dropdown-menu button:hover {
	      background-color: #f0f0f0;
	    }

	    .edit-area {
	      margin-top: 6px;
	      width: 100%;
	    }

	    .edit-actions {
	      margin-top: 6px;
	    }

	    .edit-actions button {
	      margin-right: 6px;
	    }

	    .new-comment {
	      display: flex;
	      flex-direction: column;
	      margin-top: 20px;
	      gap: 8px;
	    }

	    .new-comment textarea {
	      width: 100%;
	      height: 60px;
	      padding: 8px;
	      border-radius: 6px;
	      border: 1px solid #ccc;
	      resize: vertical;
	    }

	    .new-comment button {
	      align-self: flex-end;
	      padding: 6px 12px;
	      border: none;
	      background-color: #1976d2;
	      color: white;
	      border-radius: 4px;
	      cursor: pointer;
	    }

	    .new-comment button:hover {
	      background-color: #135ca1;
	    }
  </style>
  
  <body>
        <header class="header d-none d-lg-block">
        <!-- place navbar here -->
        <nav class="navbar navbar-expand-lg navbar-dark header__navbar p-md-0">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <img src="/images/gnolp.png" alt="Logo Truyen" srcset="" class="img-fluid" style="width: 100px;">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                Thể loại
                            </a>
                            <ul class="dropdown-menu dropdown-menu-custom" id="category-list">
                                <li><a class="dropdown-item" data-category="1">Ngôn Tình</a></li>
                                <li><a class="dropdown-item" data-category="2">Trọng Sinh</a></li>
                                <li><a class="dropdown-item" data-category="3">Cổ Đại</a></li>
                                <li><a class="dropdown-item" data-category="4">Tiên Hiệp</a></li>
                                <li><a class="dropdown-item" data-category="5">Ngược</a></li>
                                <li><a class="dropdown-item" data-category="6">Khác</a></li>
                                <li><a class="dropdown-item" data-category="7">Dị Giới</a></li>
                                <li><a class="dropdown-item" data-category="8">Huyền Huyễn</a></li>
                                <li><a class="dropdown-item" data-category="9">Xuyên Không</a></li>
                                <li><a class="dropdown-item" data-category="10">Sủng</a></li>
                                <li><a class="dropdown-item" data-category="11">Cung Đấu</a></li>
                                <li><a class="dropdown-item" data-category="12">Gia Đấu</a></li>
                            </ul>
                        </li>
                    </ul>





                    <div class="form-check form-switch me-3 d-flex align-items-center">
                        <label class="form-check-label">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-brightness-high" viewBox="0 0 16 16" style="fill: #fff;">
                                <path
                                    d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z">
                                </path>
                            </svg>
                        </label>
                        <input class="form-check-input theme_mode" type="checkbox"
                            style="transform: scale(1.3); margin-left: 12px; margin-right: 12px;">

                        <label class="form-check-label">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 384 512"
                                style="fill: #fff;">
                                <path
                                    d="M144.7 98.7c-21 34.1-33.1 74.3-33.1 117.3c0 98 62.8 181.4 150.4 211.7c-12.4 2.8-25.3 4.3-38.6 4.3C126.6 432 48 353.3 48 256c0-68.9 39.4-128.4 96.8-157.3zm62.1-66C91.1 41.2 0 137.9 0 256C0 379.7 100 480 223.5 480c47.8 0 92-15 128.4-40.6c1.9-1.3 3.7-2.7 5.5-4c4.8-3.6 9.4-7.4 13.9-11.4c2.7-2.4 5.3-4.8 7.9-7.3c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-3.7 .6-7.4 1.2-11.1 1.6c-5 .5-10.1 .9-15.3 1c-1.2 0-2.5 0-3.7 0c-.1 0-.2 0-.3 0c-96.8-.2-175.2-78.9-175.2-176c0-54.8 24.9-103.7 64.1-136c1-.9 2.1-1.7 3.2-2.6c4-3.2 8.2-6.2 12.5-9c3.1-2 6.3-4 9.6-5.8c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-3.6-.3-7.1-.5-10.7-.6c-2.7-.1-5.5-.1-8.2-.1c-3.3 0-6.5 .1-9.8 .2c-2.3 .1-4.6 .2-6.9 .4z">
                                </path>
                            </svg>
                        </label>
                    </div>

                    <form class="d-flex header__form-search" action="" method="GET">
                        <input class="form-control search-story" type="text" placeholder="Tìm kiếm" name="key_word"
                            value="">
                        <div class="col-12 search-result shadow no-result d-none">
                            <div class="card text-white bg-light">
                                <div class="card-body p-0">
                                    <ul class="list-group list-group-flush d-none">
                                        <li class="list-group-item">
                                            <a href="#" class="text-dark hover-title"></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <button class="btn" type="submit">
                            <svg xmlns="http://www.w3.org/2000/svg" height="1em"
                                viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                                <path
                                    d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z">
                                </path>
                            </svg>

                        </button>
                    </form>
                    
                    <li style="float:right;">
                        <span th:if="${session.user == null}">
                            <a href="/login" class="login-button"
                                style="display: inline-block; padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; margin-left: 10px;">Đăng
                                nhập</a>
                        </span>
                        <span th:if="${session.user != null}">
                            <a th:href="@{/account(userId=${session.userId})}" class="welcome-button">Chào mừng, <span
                                    th:text="${session.user.firstName}"></span></a>
                            <a href="/logout" class="logout-button"
                                style="display: inline-block; padding: 10px 20px; background-color: #DC3545; color: white; text-decoration: none; border-radius: 5px; margin-left: 10px;">Đăng
                                xuất</a>
                        </span>
                    </li>
                </div>
            </div>
        </nav>
    </header>

    <div class="header-mobile d-sm-block d-lg-none">
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    <img src="/images/gnolp.png" alt="Logo Truyen" srcset="" class="img-fluid" style="width: 100px;">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="offcanvas offcanvas-end text-bg-dark w-75" tabindex="-1" id="offcanvasDarkNavbar"
                    aria-labelledby="offcanvasDarkNavbarLabel">
                    <div class="offcanvas-header">
                        <img src="/images/gnolp.png" alt="Logo Truyen" srcset="" class="img-fluid" style="width: 100px;">
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <ul class="navbar-nav justify-content-end flex-grow-1 pe-3 mb-3">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                    Thể loại
                                </a>
                                <ul class="dropdown-menu dropdown-menu-custom">
                                    <li><a class="dropdown-item" data-category="13">Mạt Thế</a></li>
                                    <li><a class="dropdown-item" data-category="14">Xuyên Nhanh</a></li>
                                    <li><a class="dropdown-item" data-category="15">Hệ Thống</a></li>
                                    <li><a class="dropdown-item" data-category="16">Nữ Cường</a></li>
                                </ul>
                            </li>
                        </ul>
                        
                        <div class="form-check form-switch d-flex align-items-center mb-3 p-0">
                            <label class="form-check-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    class="bi bi-brightness-high" viewBox="0 0 16 16" style="fill: #fff;">
                                    <path
                                        d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z">
                                    </path>
                                </svg>
                            </label>
                            <input class="form-check-input theme_mode" type="checkbox"
                                style="transform: scale(1.3); margin-left: 12px; margin-right: 12px;">

                            <label class="form-check-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 384 512"
                                    style="fill: #fff;">
                                    <path
                                        d="M144.7 98.7c-21 34.1-33.1 74.3-33.1 117.3c0 98 62.8 181.4 150.4 211.7c-12.4 2.8-25.3 4.3-38.6 4.3C126.6 432 48 353.3 48 256c0-68.9 39.4-128.4 96.8-157.3zm62.1-66C91.1 41.2 0 137.9 0 256C0 379.7 100 480 223.5 480c47.8 0 92-15 128.4-40.6c1.9-1.3 3.7-2.7 5.5-4c4.8-3.6 9.4-7.4 13.9-11.4c2.7-2.4 5.3-4.8 7.9-7.3c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-3.7 .6-7.4 1.2-11.1 1.6c-5 .5-10.1 .9-15.3 1c-1.2 0-2.5 0-3.7 0c-.1 0-.2 0-.3 0c-96.8-.2-175.2-78.9-175.2-176c0-54.8 24.9-103.7 64.1-136c1-.9 2.1-1.7 3.2-2.6c4-3.2 8.2-6.2 12.5-9c3.1-2 6.3-4 9.6-5.8c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-3.6-.3-7.1-.5-10.7-.6c-2.7-.1-5.5-.1-8.2-.1c-3.3 0-6.5 .1-9.8 .2c-2.3 .1-4.6 .2-6.9 .4z">
                                    </path>
                                </svg>
                            </label>
                        </div>

                        <form class="d-flex header__form-search" action="" method="GET" id="search-in-nav-collaps">
                            <input class="form-control search-story" type="text" placeholder="Tìm kiếm" name="key_word"
                                value="">
                            <div class="col-12 search-result shadow no-result d-none" id = "search-result-in-nav-collaps">
                                <div class="card text-white bg-light">
                                    <div class="card-body p-0">
                                        <ul class="list-group list-group-flush d-none">
                                            <li class="list-group-item">
                                                <a href="#" class="text-dark hover-title"></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <button class="btn" type="submit">
                                <svg xmlns="http://www.w3.org/2000/svg" height="1em"
                                    viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                                    <path
                                        d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z">
                                    </path>
                                </svg>

                            </button>
                        </form>
                        
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <div class="bg-light header-bottom">
        <div class="container py-1">
            <p class="mb-0">Đọc truyện online, đọc truyện chữ, truyện full, truyện hay. Tổng hợp đầy đủ và cập nhật liên
                tục.</p>
        </div>
    </div>



    <main>
      <input type="hidden" id="story_slug" />
      <div class="container">
        <div class="row align-items-start">
          <div class="col-12 col-md-7 col-lg-8">
            <div class="head-title-global d-flex justify-content-between mb-4">
              <div
                class="col-12 col-md-12 col-lg-4 head-title-global__left d-flex"
              >
                <h2 class="me-2 mb-0 border-bottom border-secondary pb-1">
                  <span
                    class="d-block text-decoration-none text-dark fs-4 title-head-name"
                    title="Thông tin truyện"
                    >Thông tin truyện</span
                  >
                </h2>
              </div>
            </div>

            <div class="story-detail">
              <div class="story-detail__top d-flex align-items-start">
                <div class="row align-items-start">
                  <div
                    class="col-12 col-md-12 col-lg-3 story-detail__top--image"
                  >
                    <div class="book-3d">
                      <img
                        src=""
                        alt=""
                        id="img-fluid-img"
                        class="img-fluid w-100"
                        width="200"
                        height="300"
                        loading="lazy"
                      />
                    </div>
                  </div>
                  <div class="col-12 col-md-12 col-lg-9">
                    <h3 id="story-title" class="text-center story-name"></h3>
					<div class="rating-container">
					    <div class="stars">
					        
							
					        <div class="star" data-index="1"></div>
					        <div class="star" data-index="2"></div>
					        <div class="star" data-index="3"></div>
					        <div class="star" data-index="4"></div>
					        <div class="star" data-index="5"></div>
					        <div class="star" data-index="6"></div>
					        <div class="star" data-index="7"></div>
					        <div class="star" data-index="8"></div>
					        <div class="star" data-index="9"></div>
					        <div class="star" data-index="10"></div>
					    </div>
					    <p><span id="rating-score">8.5</span> / 10 ⭐ ( <span id="votes">0</span> votes )</p>
					</div>
                    <div
                      id="story-review"
                      class="story-detail__top--desc px-3"
                      style="max-height: 285px"
                    ></div>

                    <div class="info-more">
                      <div class="info-more--more active" id="info_more">
                        <span class="me-1 text-dark">Xem thêm</span>
                        <svg
                          width="14"
                          height="8"
                          viewBox="0 0 14 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M7.70749 7.70718L13.7059 1.71002C14.336 1.08008 13.8899 0.00283241 12.9989 0.00283241L1.002 0.00283241C0.111048 0.00283241 -0.335095 1.08008 0.294974 1.71002L6.29343 7.70718C6.68394 8.09761 7.31699 8.09761 7.70749 7.70718Z"
                            fill="#2C2C37"
                          ></path>
                        </svg>
                      </div>

                      <a class="info-more--collapse text-decoration-none">
                        <span class="me-1 text-dark">Thu gọn</span>
                        <svg
                          width="14"
                          height="8"
                          viewBox="0 0 14 8"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M7.70749 0.292817L13.7059 6.28998C14.336 6.91992 13.8899 7.99717 12.9989 7.99717L1.002 7.99717C0.111048 7.99717 -0.335095 6.91992 0.294974 6.28998L6.29343 0.292817C6.68394 -0.097606 7.31699 -0.0976055 7.70749 0.292817Z"
                            fill="#2C2C37"
                          ></path>
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="story-detail__bottom mb-3">
                <div class="row">
                  <div
                    class="col-12 col-md-12 col-lg-3 story-detail__bottom--info"
                  >
                    <p class="mb-1">
                      <strong>Tác giả:</strong>
                      <a
                        href="#"
                        id="authorName"
                        class="text-decoration-none text-dark hover-title"
                      ></a>
                    </p>

                    <div class="d-flex align-items-center mb-1 flex-wrap">
                      <strong class="me-1">Thể loại:</strong>
                      <span id="theloai" class="text-info"></span>
                    </div>

                    <p class="mb-1">
                      <strong>Trạng thái:</strong>
                      <span id="text-info-status" class="text-info"></span>
                    </p>
                  </div>
                </div>
              </div>

              <div class="story-detail__list-chapter">
                <div
                  class="head-title-global d-flex justify-content-between mb-4"
                >
                  <div
                    class="col-6 col-md-12 col-lg-4 head-title-global__left d-flex"
                  >
                    <h2 class="me-2 mb-0 border-bottom border-secondary pb-1">
                      <span
                        href="#"
                        class="d-block text-decoration-none text-dark fs-4 title-head-name"
                        title="Truyện hot"
                        >Danh sách chương</span
                      >
                    </h2>
                  </div>
                </div>

                <!-- HTML để hiển thị danh sách chương -->
                <div id="chapter-list" class="chapter-list-container"></div>

                <!-- Div chứa nút phân trang -->
				<div class="row">
					<div id="pagination" class="d-flex justify-content-start mt-5 flex-wrap"></div>
				</div>
              </div>
            </div>
			<div id="comments-container">
				<button id="load-more-btn" onclick="loadMoreComments()">Hiển thị thêm</button>
			  <!-- Các comment sẽ ở đây -->
			</div>
			<div class="new-comment">
			  <textarea id="new-comment-content" placeholder="Viết bình luận..."></textarea>
			  <button onclick="postComment()">Đăng</button>
			</div>
			<script>
			  let currentPageCmt = 1;
			  const idBook = JSON.parse(localStorage.getItem("data")).story.id;
			  const currentUser = localStorage.getItem("userId");
			  console.log("id", idBook);
			  window.onload = () => {
			    document.getElementById('new-comment-content').value = "";
			    loadMoreComments(); // Tải trang đầu
			  };
			
			  async function loadMoreComments() {
			    try {
			      const res = await fetch(`/get-comment/${idBook}?page=${currentPageCmt}`);
			      const data = await res.json();
			      const comments = data.comments;
			      console.log(comments);

			      if (comments.length === 0) {
			        document.getElementById('load-more-btn').disabled = true;
			        document.getElementById('load-more-btn').textContent = 'Hết bình luận';
			        return;
			      }

			      comments.forEach(c => {
			        renderComment({
			          id: c.id,
			          author: c.author,
			          name: c.author_name,
			          content: c.content,
			          time: new Date(c.createAt).toLocaleString('vi-VN'),
					  canEdit: c.canEdit,
			        });
			      });

			      currentPageCmt++;  // Tăng page sau khi load xong
			    } catch (err) {
			      console.error("Lỗi khi tải bình luận:", err);
			    }
			  }

			
			  function renderComment({ id, author, name, content, time,canEdit  }) {
			    const comment = document.createElement('div');
			    comment.className = 'comment';
			    comment.dataset.author = author;
			    comment.dataset.id = id;
				comment.dataset.canEdit = canEdit;	
			    comment.innerHTML = `
			      <div class="comment-left">
			        <div class="avatar"></div>
			        <div class="comment-content">
			          <div class="comment-header">${name}</div>
			          <div class="comment-time">${time}</div>
			          <div class="comment-text">${content}</div>
			        </div>
			      </div>
			      <div class="comment-options" onclick="toggleDropdown(this)">&#8942;
			        <div class="dropdown-menu"></div>
			      </div>
			    `;
			
			    const container = document.getElementById('comments-container');
			    container.appendChild(comment);
			  }
			
			  async function postComment() {
			      const content = document.getElementById('new-comment-content').value.trim();
			      if (!content) return;

			      const payload = { content };

			      console.log("content:", content);

			      try {
			          const res = await fetch(`/comment?book_id=${idBook}`, {
			              method: 'POST',
			              headers: { 'Content-Type': 'application/json' },
			              body: JSON.stringify(payload)
			          });
			          const result = await res.json();

			          if (res.ok) {
			              const comment = result.comment;
			              renderComment({
			                  id: comment.id,
			                  author: comment.author,
			                  name: comment.author_name || comment.name || "Ẩn danh",
			                  content: comment.content,
			                  time: new Date(comment.createAt || Date.now()).toLocaleString('vi-VN'),
							  canEdit: comment.canEdit,
			              });
			              document.getElementById('new-comment-content').value = "";
			          } else {
			              alert(result.message || "Lỗi khi đăng bình luận.");
			          }
			      } catch (err) {
			          console.error("Lỗi gửi bình luận:", err);
			      }
			  }

			
			  function editComment(btn) {
				  const comment = btn.closest('.comment');
				  const canEdit = comment.dataset.canEdit === 'true';
				  if (!canEdit) {
				    alert("Bạn không có quyền sửa bình luận này.");
				    return;
				  }
				
				  const textEl = comment.querySelector('.comment-text');
				  const oldText = textEl.textContent;
				
				  const textarea = document.createElement('textarea');
				  textarea.value = oldText;
				  textarea.className = 'edit-area';
				  textEl.replaceWith(textarea);
				
				  const actions = document.createElement('div');
				  actions.className = 'edit-actions';
				  actions.innerHTML = `
				    <button onclick="saveEdit(this)">Lưu</button>
				    <button onclick="cancelEdit(this)">Hủy</button>
				  `;
				
				  textarea.after(actions);
				  btn.closest('.dropdown-menu').style.display = 'none';
				}

			
			  async function saveEdit(btn) {
				  const comment = btn.closest('.comment');
				  const textarea = comment.querySelector('textarea');
				  const newText = textarea.value.trim();
				  const commentId = comment.dataset.id;
				
				  if (!newText) {
				    alert("Nội dung bình luận không được để trống.");
				    return;
				  }
				
				  try {
				    const res = await fetch(`/edit-comment/${commentId}`, {
				      method: 'PUT',
				      headers: { 'Content-Type': 'application/json' },
				      body: JSON.stringify({ content: newText })
				    });
				
				    if (!res.ok) {
				      const errData = await res.json().catch(() => ({}));
				      alert(errData.message || "Không thể lưu chỉnh sửa.");
				      return;
				    }
				
				    const textEl = document.createElement('div');
				    textEl.className = 'comment-text';
				    textEl.textContent = newText;
				
				    // Xoá nút Lưu, Hủy
				    const actions = textarea.nextElementSibling;
				    if (actions) actions.remove();
				
				    textarea.replaceWith(textEl);
				  } catch (err) {
				    console.error("Lỗi khi lưu chỉnh sửa:", err);
				    alert("Có lỗi xảy ra khi lưu bình luận.");
				  }
				}
			
			  function cancelEdit(btn) {
			    const comment = btn.closest('.comment');
			    const textarea = comment.querySelector('textarea');
			    const oldText = textarea.defaultValue;
			
			    const textEl = document.createElement('div');
			    textEl.className = 'comment-text';
			    textEl.textContent = oldText;
			
			    textarea.nextElementSibling.remove();
			    textarea.replaceWith(textEl);
			  }
			
			  function toggleDropdown(el) {
			    const comment = el.closest('.comment');
			    const menu = el.querySelector('.dropdown-menu');

			    // Lấy giá trị canEdit từ data attribute, chuyển sang boolean
			    const canEdit = comment.dataset.canEdit === 'true';

			    if (menu.style.display === "block") {
			      menu.style.display = "none";
			    } else {
			      menu.innerHTML = "";

			      if (canEdit) {
			        menu.innerHTML += "<button onclick='editComment(this)'>Chỉnh sửa</button>";
			        menu.innerHTML += "<button onclick='deleteComment(this)'>Xóa</button>";
			      } else {
			        menu.innerHTML += "<button onclick='hideComment(this)'>Ẩn</button>";
			      }

			      menu.style.display = "block";
			    }
			  }
			
			  async function deleteComment(btn) {
			    const comment = btn.closest('.comment');
			    const commentId = comment.dataset.id;

			    const confirmDelete = confirm("Bạn có chắc muốn xoá bình luận này?");
			    if (!confirmDelete) return;

			    try {
			      const res = await fetch(`/delete-comment/${commentId}`, {
			        method: 'DELETE'
			      });

			      const data = await res.json();

			      if (res.ok) {
			        comment.remove(); // Xoá khỏi DOM
			        alert(data.message || "Đã xoá bình luận.");
			      } else {
			        alert(data.message || "Không có quyền xoá bình luận.");
			      }
			    } catch (err) {
			      console.error("Lỗi khi xoá bình luận:", err);
			      alert("Có lỗi xảy ra khi xoá bình luận.");
			    }
			  }

			
			  function hideComment(btn) {
				const comment = btn.closest('.comment');
				comment.remove();
			    alert("Bình luận đã bị ẩn khỏi bạn.");
			  }
			
			  // Đóng dropdown khi click ngoài
			  document.addEventListener('click', function (event) {
			    const isDropdown = event.target.closest('.comment-options');
			    document.querySelectorAll('.dropdown-menu').forEach(menu => {
			      if (!isDropdown || !isDropdown.contains(menu)) {
			        menu.style.display = 'none';
			      }
			    });
			  });
			</script>

          </div>

          <div class="col-12 col-md-5 col-lg-4 sticky-md-top">
            <div class="row top-ratings">
              <div
                class="head-title-global d-flex justify-content-between mb-4"
              >
                <div
                  class="col-12 col-md-12 col-lg-4 head-title-global__left d-flex"
                >
                  <h2 class="me-2 mb-0 border-bottom border-secondary pb-1">
                    <span
                      class="d-block text-decoration-none text-dark fs-4 title-head-name"
                      title="Thông tin truyện"
                      >Truyện Hot</span
                    >
                  </h2>
                </div>
              </div>
              <div class="col-12 top-ratings__content">
                <div class="tab-content" id="nav-tabContent">
                  <div
                    class="tab-pane fade show active"
                    id="top-day"
                    role="tabpanel"
                    aria-labelledby="top-day-list"
                  >
                    <ul>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-danger rounded-circle"
                          >
                            <span class="text-light">1</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1012"
                              onclick="sendStoryName(this); return false;"
                              >Linh Vũ Thiên Hạ</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="4"
                                onclick="sendCategoryName(this); return false;"
                                >Tiên Hiệp</a
                              >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="7"
                                onclick="sendCategoryName(this); return false;"
                                >Dị Giới</a
                              >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="8"
                                onclick="sendCategoryName(this); return false;"
                                >Huyền Huyễn</a
                              >
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="9"
                                onclick="sendCategoryName(this); return false;"
                                >Xuyên Không</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-success rounded-circle"
                          >
                            <span class="text-light">2</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1013"
                              onclick="sendStoryName(this); return false;"
                              >Thần Đạo Đan Tôn</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="4"
                                onclick="sendCategoryName(this); return false;"
                                >Tiên Hiệp,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="8"
                                onclick="sendCategoryName(this); return false;"
                                >Huyền Huyễn</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-info rounded-circle"
                          >
                            <span class="text-light">3</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1017"
                              onclick="sendStoryName(this); return false;"
                              >Mê Vợ Không Lối Về</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="1"
                                onclick="sendCategoryName(this); return false;"
                                >Ngôn Tình,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="5"
                                onclick="sendCategoryName(this); return false;"
                                >Ngược,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="10"
                                onclick="sendCategoryName(this); return false;"
                                >Sủng</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">4</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1016"
                              onclick="sendStoryName(this); return false;"
                              >Đấu Phá Thương Khung</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="4"
                                onclick="sendCategoryName(this); return false;"
                                >Tiên Hiệp,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="7"
                                onclick="sendCategoryName(this); return false;"
                                >Dị Giới,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="8"
                                onclick="sendCategoryName(this); return false;"
                                >Huyền Huyễn</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">5</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1018"
                              onclick="sendStoryName(this); return false;"
                              >Thế Giới Hoàn Mỹ</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="4"
                                onclick="sendCategoryName(this); return false;"
                                >Tiên Hiệp,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="17"
                                onclick="sendCategoryName(this); return false;"
                                >Kiếm Hiệp,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="8"
                                onclick="sendCategoryName(this); return false;"
                                >Huyền Huyễn</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">6</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1020"
                              onclick="sendStoryName(this); return false;"
                              >Cô Vợ Ngọt Ngào Có Chút Bất Lương</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="1"
                                onclick="sendCategoryName(this); return false;"
                                >Ngôn Tình,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="2"
                                onclick="sendCategoryName(this); return false;"
                                >Trọng Sinh,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="10"
                                onclick="sendCategoryName(this); return false;"
                                >Sủng</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">7</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1021"
                              onclick="sendStoryName(this); return false;"
                              >Phàm Nhân Tu Tiên</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="4"
                                onclick="sendCategoryName(this); return false;"
                                >Tiên Hiệp,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="17"
                                onclick="sendCategoryName(this); return false;"
                                >Kiếm Hiệp</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">8</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1022"
                              onclick="sendStoryName(this); return false;"
                              >Nhất Niệm Vĩnh Hằng</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="4"
                                onclick="sendCategoryName(this); return false;"
                                >Tiên Hiệp,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="8"
                                onclick="sendCategoryName(this); return false;"
                                >Huyền Huyễn</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">9</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1023"
                              onclick="sendStoryName(this); return false;"
                              >Đế Bá</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="8"
                                onclick="sendCategoryName(this); return false;"
                                >Huyền Huyễn</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="rating-item d-flex align-items-center">
                          <div
                            class="rating-item__number bg-light border rounded-circle"
                          >
                            <span class="text-dark">10</span>
                          </div>
                          <div class="rating-item__story">
                            <a
                              class="text-decoration-none hover-title rating-item__story--name text-one-row"
                              data-id="1024"
                              onclick="sendStoryName(this); return false;"
                              >Rể Quý Trời Cho</a
                            >
                            <!-- Gọi hàm JS với 'this' để truyền đối tượng a -->

                            <div
                              class="d-flex flex-wrap rating-item__story--categories"
                            >
                              <a
                                class="text-decoration-none text-dark hover-title me-1"
                                data-category="1"
                                onclick="sendCategoryName(this); return false;"
                                >Ngôn Tình,
                              </a>
                              <a
                                class="text-decoration-none text-dark hover-title"
                                data-category="18"
                                onclick="sendCategoryName(this); return false;"
                                >Đô Thị</a
                              >
                            </div>
                          </div>
                        </div>
                      </li>
                    </ul>
                    <style>
                      a {
                        cursor: pointer;
                      }
                    </style>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div id="footer" class="footer border-top pt-2">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <strong>N-13 Truyện</strong> :
            <a
              title="Đọc truyện online"
              class="text-dark text-decoration-none"
              href="#"
              >Đọc truyện</a
            >
            online một cách nhanh nhất. Hỗ trợ mọi thiết bị như di động và máy
            tính bảng.
          </div>
        </div>
      </div>
    </div>
    <script>
		function updateRatingUI(rating, votes) {
		    const stars = document.querySelectorAll(".star");
		    document.getElementById("rating-score").textContent = rating.toFixed(1);
		    document.getElementById("votes").textContent = votes;

		    const fullStars = Math.floor(rating); 
		    const partialStar = rating - fullStars;

		    stars.forEach((star, index) => {
		        star.classList.remove("filled", "partial");
		        star.style.setProperty("--partial-width", "0%");
		        
		        if (index < fullStars) {
		            star.classList.add("filled");
		        } else if (index === fullStars && partialStar > 0) {
		            star.classList.add("partial");
		            star.style.setProperty("--partial-width", `${partialStar * 100}%`);
		        }
		    });
		}
		function displayStoryData(data) {
		  const authorId = data.story.author_id;
		  
		  document.getElementById("story-title").textContent = data.story.title;
		  document.getElementById("authorName").textContent = data["bút danh"];
		  localStorage.setItem("authorId", authorId);
		  document.getElementById(
		    "authorName"
		  ).href = `/account?userId=${authorId}`;
		  document.getElementById("img-fluid-img").src = data.story.srcA;
		  document.getElementById("text-info-status").textContent =
		    data.story.status;
		  document.getElementById("theloai").textContent = data.theloai;
		  // Điền thông tin mô tả
		  document.getElementById("story-review").textContent = data.story.mo_ta;

		  localStorage.setItem("story-name", data.story.title);
		  localStorage.setItem("story-id", data.story.id);
		}
		let currentPage = 1;
		const chaptersPerPage = 2;

		async function fetchChapters(page) {
		  const storyId = localStorage.getItem("story-id");
		  if (!storyId) {
		    console.error("Không tìm thấy story-id trong localStorage");
		    return;
		  }

		  try {
		    const response = await fetch(`/get-chapter-of-story/${storyId}?page=${page}`);
		    const chapters = await response.json();
		    displayChapters(chapters);
		  } catch (error) {
		    console.error("Lỗi khi lấy chương:", error);
		  }
		}

		function displayChapters(chapters) {
		  const chapterListDiv = document.getElementById("chapter-list");
		  chapterListDiv.innerHTML = "";

		  const column1 = document.createElement("div");
		  const column2 = document.createElement("div");
		  column1.classList.add("column");
		  column2.classList.add("column");

		  chapters.forEach((chapter, index) => {
		    const chapterDiv = document.createElement("div");
		    chapterDiv.textContent = `Chương ${chapter.number}: ${chapter.title}`;
		    chapterDiv.classList.add("chapter-item");
		    chapterDiv.style.cursor = "pointer";

		    chapterDiv.addEventListener("click", async function () {
		      const response = await fetch(`/get/content/${chapter.id}`);
		      const data_content = await response.json();
		      const chapterData = {
		        number: chapter.number,
		        title: chapter.title,
		        content: data_content.content,
		        id: chapter.id,
		      };
		      const viewsLog = {
		        bookId: localStorage.getItem("story-id"),
		        chapterId: chapter.id,
		      };
		      fetch("/increase-views", {
		        method: "PATCH",
		        headers: { "Content-Type": "application/json" },
		        body: JSON.stringify(viewsLog),
		      }).catch(error => console.error("Lỗi cập nhật lượt xem:", error));

		      localStorage.setItem("selectedChapter", JSON.stringify(chapterData));
		      window.location.href = "/chapter";
		    });

		    if (index < chapters.length / 2) {
		      column1.appendChild(chapterDiv);
		    } else {
		      column2.appendChild(chapterDiv);
		    }
		  });

		  chapterListDiv.appendChild(column1);
		  chapterListDiv.appendChild(column2);
		}

		function setupPaginationButtons(so_chuong) {
		  const paginationDiv = document.getElementById("pagination");
		  paginationDiv.innerHTML = "";

		  const totalPages = Math.ceil(so_chuong / chaptersPerPage);

		  for (let i = 1; i <= totalPages; i++) {
		    const start = (i - 1) * chaptersPerPage + 1;
		    const end = Math.min(i * chaptersPerPage, so_chuong);

		    const button = document.createElement("button");
		    button.textContent = `Chương ${start}–${end}`;
		    button.classList.add("btn", "btn-outline-primary", "m-1");

		    if (i === currentPage) button.classList.add("active");

		    button.addEventListener("click", () => {
		      currentPage = i;
		      fetchChapters(currentPage);
		      highlightActiveRange(i);
		    });

		    paginationDiv.appendChild(button);
		  }
		}

		function highlightActiveRange(activePage) {
		  const buttons = document.querySelectorAll("#pagination button");
		  buttons.forEach((btn, idx) => {
		    if (idx === activePage - 1) {
		      btn.classList.add("active");
		    } else {
		      btn.classList.remove("active");
		    }
		  });
		}

		// Gọi khi DOM đã load
		document.addEventListener("DOMContentLoaded", function () {
				    //fetch("/api/get-rating")
				    //   .then(response => response.json())
				    //    .then(data => {
				    //        updateRatingUI(data.rating, data.votes, data.partial_star);
				    //    })
				    //    .catch(error => console.error("Lỗi khi tải rating:", error));
					updateRatingUI(8.5, 1000);
					const data = JSON.parse(localStorage.getItem("data"));
						if (data) {
							displayStoryData(data);
					}
					const soChuong = parseInt(data.story.so_chuong);
					if (!soChuong || isNaN(soChuong)) {
					    console.error("Không tìm thấy số chương trong localStorage");
					    return;
					}
					setupPaginationButtons(soChuong);
					fetchChapters(currentPage);
				});

		</script>
		
    <script src="/jquery.min.js"></script>

    <script src="/popper.min.js"></script>

    <script src="/bootstrap.min.js"></script>

    <script src="/app.js"></script>
    <script src="/common.js"></script>

    <div id="loadingPage" class="loading-full">
      <div class="loading-full_icon">
        <div class="spinner-grow">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
  </body>
</html>
